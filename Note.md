## 项目概述

Arch Map 是一个系统架构导览工具，用于管理和展示系统架构相关的文档和技术方案。该项目主要功能包括：

1. 从飞书文档中获取数据（ETL过程）
2. 存储到PostgreSQL数据库
3. 通过Web API提供架构数据查询和展示功能

## 项目架构

项目采用Rust语言开发，主要组件如下：

### 核心模块

1. **ETL模块**（etl）:
   - extract.rs: 从飞书获取数据
   - transform_load.rs: 转换数据并加载到数据库
   - feishu_config.rs: 飞书API配置

2. **数据库模块**（database）:
   - models.rs: 数据模型定义
   - dml_interface.rs: 数据库操作接口

3. **后端API**（`src/backend.rs`）: 
   - 提供REST API接口，用于查询架构数据
   - 实现数据过滤和分类功能

4. **主应用**（`src/main.rs`）:
   - 设置HTTP服务
   - 配置路由和CORS

5. **独立工具**（bin）:
   - data_sync.rs: 数据同步工具
   - handle_hyperlink.py: 处理Excel中的超链接

### 数据模型

项目使用层次化的数据模型来组织架构信息，包括：

- **技术方案** (TechL1/TechL2)
- **系统部件** (SystemL1/SystemL2)
- **MF软件** (MfL1/MfL2)
- **项目标签** (ProjectL1/ProjectL2)
- **文档** (Document)和各类关联映射

每个分类都采用两级结构，使架构信息更有条理性。

## 工作流程

1. **数据采集**：
   - 调用飞书API获取Excel文档
   - 使用Python脚本处理Excel中的超链接

2. **数据转换**：
   - 将Excel数据转换为Rust内部数据结构
   - 处理层次关系和标签关联

3. **数据加载**：
   - 将转换后的数据存入PostgreSQL
   - 维护标签间的关联关系

4. **数据查询**：
   - 通过REST API提供架构树和文档查询
   - 支持按技术、系统、MF软件和项目过滤

## 技术亮点

1. **异步处理**：使用Tokio进行异步操作，提高并发性能
2. **类型安全**：利用Rust强类型系统保证数据完整性
3. **连接池**：使用SQLx连接池管理数据库连接
4. **HTTPS支持**：通过自签名证书实现安全通信
5. **跨语言集成**：结合Rust和Python（通过pyo3）处理复杂数据格式

## 可能的面试问题

### 架构设计相关

1. **Q**: 为什么选择Rust作为开发语言？与使用Go或Node.js相比有什么优势？
   - **A**: Rust提供内存安全保证、无GC的高性能、丰富的类型系统和优秀的并发模型。相比Go，Rust有更严格的内存安全机制；相比Node.js，Rust性能更高且类型更安全。

2. **Q**: 项目中的数据模型是如何设计的？为什么使用两级结构？
   - **A**: 采用两级结构（L1/L2）使分类更清晰，便于层次化展示和查询。每个标签类别（技术、系统、MF软件、项目）都使用这种结构，保持了一致性并简化了前端展示逻辑。

3. **Q**: 如何处理这个系统可能面临的并发问题？
   - **A**: 系统使用Tokio异步运行时处理并发请求，SQLx连接池管理数据库连接，避免连接过多的问题。对于数据同步，采用定时任务方式避免实时同步的并发压力。

### 技术细节相关

4. **Q**: 如何保证从飞书导入的数据与现有数据的一致性？
   - **A**: 在`transform_load.rs`中实现了增量导入机制。系统先读取现有数据(`read_exist_data`)，然后在导入新数据时避免重复。每个实体都使用UUID作为标识，确保数据一致性。

5. **Q**: 为什么在处理Excel超链接时使用Python而不是Rust？
   - **A**: Excel超链接处理在Python中有更成熟的库支持（openpyxl）。通过进程调用Python脚本处理，避免了复杂的FFI集成，同时保持了代码的可维护性。

6. **Q**: 项目中的错误处理策略是什么？
   - **A**: 项目使用`anyhow`库进行错误处理和上下文传递，采用`Result`类型进行错误传播。关键操作都有适当的错误处理和日志记录，确保系统可靠性和可调试性。

### 性能与扩展性

7. **Q**: 如果数据量大幅增长，该系统会面临哪些挑战，你会如何优化？
   - **A**: 可能面临查询性能下降和数据同步耗时增加。优化方案包括：添加更多索引、实现查询缓存、分批处理数据同步、考虑分库分表或使用NoSQL存储特定数据。

8. **Q**: 当前系统如何处理大量并发API请求？
   - **A**: 使用Axum框架的异步处理能力和Tokio运行时，系统能有效处理并发请求。数据库操作使用连接池避免连接耗尽。可进一步通过API网关、负载均衡或缓存层增强并发处理能力。

9. **Q**: 如何扩展系统以支持新的数据源或文档类型？
   - **A**: ETL模块设计为可扩展的，可以添加新的extract实现来支持不同数据源。数据模型也可扩展以支持新的文档类型和关联关系。`InternalData`结构设计为可容纳新的数据类型。

### 安全性

10. **Q**: 项目中如何处理安全性问题，特别是API访问和数据保护？
    - **A**: 系统使用HTTPS（通过自签名证书）提供安全通信。飞书API访问使用授权token。可以进一步添加API认证机制和访问控制。敏感信息（如数据库凭证）应通过环境变量或安全的配置管理。

## 改进建议

1. **添加测试覆盖**：增加单元测试和集成测试提高代码质量
2. **API文档**：使用Swagger/OpenAPI生成API文档
3. **监控与日志**：实现更完善的监控和日志记录
4. **容器化部署**：使用Docker和Kubernetes简化部署
5. **前端集成**：开发配套前端界面，提供更友好的用户体验
6. **认证授权**：添加用户认证和权限管理

这个项目展示了一个典型的企业架构管理工具的后端实现，结合了ETL处理、数据存储和API提供等多个方面，是一个全面的系统架构示例。